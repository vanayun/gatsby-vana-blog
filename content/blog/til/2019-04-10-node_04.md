---
title: Node.js Design Pattern - 관찰자 패턴(The observer pattern)
date: 2019-04-10 23:04:75
category: til
---
*관찰자 패턴*은 상태 변화가 일어날 때 관찰자에게 알릴 수 있는 객체를 정의하는 것.

##EventEmitter 클래스
관찰자 패턴은 이미 Node.js 코어에 내장되어 있으며 EventEmitter클래스를 통해 사용할 수 있다.
EventEmitter클래스를 사용하여 특정 유형의 이벤트가 발생되면 호출될 하나 이상의 함수를 Listener로 등록할 수 있다.

```javascript
const EventEmitter = require('events').EventEmitter;
const eeInstance = new EventEmitter();
```

####EventEmitter의 필수 메소드
| method      | Description |
| ----------- | ----------- |
| on(event, lisener)      | 주어진 이벤트 유형(문자열)에 대해 새로운 listener를 등록할 수 있다.       |
| once(event, listener)   | 첫 이벤트가 전달된 후 제거되는 새로운 listener를 등록한다.        |
| emit(event, [arg1], [...])   | 새 이벤트를 생성하고 listener에게 전달할 추가적인 인자들을 지원한다.        |
| removeListener(event, listener)   | 지정된 이벤트 유형에 대한 listener를 제거한다.        |

##EventEmitter 생성 및 사용
`gist:vanayun/ff758564353eb356d5b8fbc65525b524#findPattern01.js`

##오류 전파
EventEmitter는 이벤트가 비동기적으로 발생할 경우, 이벤트 루프에서 손실될 수 있기 때문에 callback과 같이 예외가 발생해도 바로 throw할 수 없다.
대신 error라는 특수한 이벤트를 발생 시키고 Error 객체를 인자로 전달한다.

Node.js는 특별한 방식으로 에러 이벤트를 처리하고 예외를 자동으로 throw하며, 이에 연결된 리스너가 없는 경우 프로그램을 종료하므로 항상 에러 이벤트에 대한 리스너를 등록하는 것이 좋다.

##관찰 가능한 객체 만들기
`gist:vanayun/d30ffaf66cb8b1019b87594368a3230e#findPattern02.js`

